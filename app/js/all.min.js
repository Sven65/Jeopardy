/* Copyright Mackan */
'use strict';var DOMStuff=function(){var a=function(c){return new b(c)},b=function(c){return this.element=c,'string'==typeof c?this.DOMElement=document.querySelector(c):c instanceof HTMLElement&&(this.DOMElement=c),this};return a.fn=b.prototype={addClass:function addClass(c){return this.DOMElement.classList?this.DOMElement.classList.add(c):this.DOMElement.className+=' '+c,this},removeClass:function removeClass(c){return this.DOMElement.classList?this.DOMElement.classList.remove(c):this.DOMElement.className=this.DOMElement.className.replace(new RegExp('(^|\\b)'+c.split(' ').join('|')+'(\\b|$)','gi'),' '),this},isScrolledIntoView:function isScrolledIntoView(){var c=this.DOMElement.getBoundingClientRect().top,f=this.DOMElement.getBoundingClientRect().bottom,g=0<=c&&f<=window.innerHeight;return g},hasClass:function hasClass(c){return this.DOMElement.classList?this.DOMElement.classList.contains(c):new RegExp('(^| )'+c+'( |$)','gi').test(this.DOMElement.className)},on:function on(c,f){this.DOMElement.addEventListener(c,f)},getChildren:function getChildren(c){return this.DOMElement.querySelectorAll(c)},style:function style(c,f){this.DOMElement.style[c]=f},getHTMLElement:function getHTMLElement(){return this.DOMElement}},a}(),chatButton=document.querySelector('#chatButton'),messageInput=document.querySelector('#message');function sendMessage(a,b,c){socket.emit('chat',{message:a,roomID:b,user:c,timeStamp:Date.now()})}chatButton.addEventListener('click',function(a){a.preventDefault(),sendMessage(messageInput.value,roomID,user),messageInput.value=''}),messageInput.addEventListener('keydown',function(a){13===a.keyCode&&(a.preventDefault(),sendMessage(messageInput.value,roomID,user),messageInput.value='')}),socket.on('chat',function(a){messageContainer.appendChild(htmlToElement('\n\t\t\t<li class="chat-message" data-sender="'+a.user.id+'" data-timestamp="'+a.timeStamp+'">\n\t\t\t\t<img src="http://placehold.it/128x128" class="chat-image"/>\n\t\t\t\t<div class="message-wrap">\n\t\t\t\t\t<span class="chat-sender">'+a.user.username+'</span>\n\t\t\t\t\t<span class="chat-message">'+a.message+'</span>\n\t\t\t\t</div>\n\t\t\t</li>\n\t\t')),document.querySelector('.chat-message[data-timestamp=\''+a.timeStamp+'\']').scrollIntoView()});var messageContainer=document.querySelector('#chat-messages'),socket=io(),roomID='',user={},joinedUsers=[],questionsLoaded=!1;function htmlToElement(a){var b=document.createElement('template');return a=a.trim(),b.innerHTML=a,b.content.firstChild}function addChatMessage(a,b,c,f,g){messageContainer.appendChild(htmlToElement('\n\t\t\t<li class="chat-message" data-sender="'+c+'" data-timestamp="'+a+'">\n\t\t\t\t'+('SYSTEM'===c?'<!--':'')+'<img src="http://placehold.it/128x128" class="chat-image"/>'+('SYSTEM'===c?'-->':'')+'\n\t\t\t\t<div class="message-wrap">\n\t\t\t\t\t'+('SYSTEM'===c?'<!--':'')+'<span class="chat-sender">'+f+'</span>'+('SYSTEM'===c?'-->':'')+'\n\t\t\t\t\t<span class="chat-message">'+g+'</span>\n\t\t\t\t</div>\n\t\t\t</li>\n\t\t')),document.querySelector('.chat-message[data-timestamp=\''+a+'\']').scrollIntoView()}document.querySelector('#playButton').addEventListener('click',function(){roomID=document.querySelector('#gameCode').value,user.username=document.querySelector('#username').value,user.id=socket.id,socket.emit('JOIN',{gameCode:document.querySelector('#gameCode').value,username:document.querySelector('#username').value})}),socket.on('USER_JOIN',function(a){DOMStuff('#beforeGame').addClass('hidden'),DOMStuff('#gameArea').removeClass('hidden'),document.querySelector('#gameCodeHeader').innerHTML=roomID,-1>=joinedUsers.indexOf(a.id)&&(document.querySelector('#card-container').appendChild(htmlToElement('\n\t\t\t\t<div class="col s3 user-card" data-userid="'+a.id+'">\n\t\t\t\t\t<div class="card">\n\t\t\t\t\t\t<div class="card-image">\n\t\t\t\t\t\t\t<img src="http://placehold.it/128x128">\n\t\t\t\t\t\t\t<span class="card-title">'+a.username+'</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="card-content">\n\t\t\t\t\t\t\t<p>$0</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t')),addChatMessage(a.timeStamp,null,'SYSTEM','SYSTEM','User '+a.username+' Joined!'),joinedUsers.push(a.id),!questionsLoaded&&socket.emit('ACTION_GETQUESTIONS',{gameCode:roomID}))}),socket.on('USER_LEAVE',function(a){-1<joinedUsers.indexOf(a.id)&&(console.log('LEAVE',a),addChatMessage(a.timeStamp,null,'SYSTEM','SYSTEM','User '+a.username+' Left!'),document.querySelector('.chat-message[data-timestamp=\''+a.timeStamp+'\']').scrollIntoView(),document.querySelector('.user-card[data-userid=\''+a.id+'\']').remove(),joinedUsers.splice(joinedUsers.indexOf(a.id),1))}),socket.on('ACTION_GOTQUESTIONS',function(a){questionsLoaded||(questionsLoaded=!0,console.log('GOT QUESTIONS',a),Object.keys(a.clues).forEach(function(b,c){document.querySelector('#game-cat'+(c+1)).innerHTML=a.clues[b][0].category.title}),addChatMessage(a.timeStamp,null,'SYSTEM','SYSTEM','Questions Loaded!'))}),socket.on('GERROR',function(a){'JOIN'===a.type&&(document.querySelector('#headerText').innerHTML=a.reason)}),socket.on('DEBUG',function(a){console.log('[DEBUG]',a)});